---
book: 'Clr via C#'
tags: synopsis
---

# Глава 20. Исключения и управление состоянием

### Оставшиеся вопосы

1. Что такое кадры в контексте StackTrace ?

### CLS-совместимые и CLS-несовместимые исключения



### System.Exception

#### Свойство StackTrace

Строка в этом свойстве генерируется CLR. Если просто создать объект исключения и прочитать его свойство StackTrace то результатом будет null.

Когда исключение возникает CLR делает запись о точке его возникновения. Когда исключение попадает в блок catch CLR делает запись о точке обнаружения исключения. Если в блоке catch обратиться к свойству StackTrace исключения, то CLR генерирует строку в которой будут находится все методы от точки возникновения исключения, до точки его обнаружения.

Если в блоке catch заново выбросить исключение, то это будет считаться новой точкой возникновения исключения, CLR будет считать, что точка возникновения исключения - текущее место и в StackTrace эта точка будет указана как самая первая.

Если в блоке catch перевыбросить исключение \(просто вызвать throw без объекта исключения\), то начальная точка не будет перезаписана и будет доступен полный StackTrace от начальной точки исключения.

Строка со стектрейсом не включает методы находящиеся выше места блока catch. Если вам нужно получить полный стектрейс от начала потока до точки обработки исключения, можно использовать тип `System.Diagnostics.StackTrace`

Если CLR находит для ваших сборок pdb-файлы \(файлы символических имён отладки\), она включает в строку стектрейса пути файлов исходного кода и номера строк.

В стектрейсе могут отсутствовать имена каких-то методов - это может происходить из-за инлайнинга. В дебаг конфигурации инлайнинг запрещён.

Также у метода можно использовать атрибут `MethodImplAttribute `и настраивать инлайнинг для него в ручную.

```
internal sealed class SomeType {
    [System.Runtime.CompilerServices.MethodImpl(MethodImplOptions.NoInlining)]
    public void SomeMethod() {
    
    }
}
```



